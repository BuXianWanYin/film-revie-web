<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<body>
    <!-- 导航栏片段 -->
    <header th:fragment="navbar">
        <nav class="navbar">
            <div class="nav-container">
                <a href="/" class="nav-logo">南京照相馆观影感悟</a>
                <div class="hamburger" onclick="toggleMobileMenu()">
                    <span></span>
                    <span></span>
                    <span></span>
                </div>
                <ul class="nav-menu" id="navMenu">
                    <li class="nav-item">
                        <a th:href="@{/}" class="nav-link" th:classappend="${activePage == 'home'} ? 'active'" onclick="closeMobileMenu()">首页</a>
                    </li>
                    <li class="nav-item">
                        <a th:href="@{/movie-intro}" class="nav-link" th:classappend="${activePage == 'movie-intro'} ? 'active'" onclick="closeMobileMenu()">电影介绍</a>
                    </li>
                    <li class="nav-item">
                        <a th:href="@{/actors}" class="nav-link" th:classappend="${activePage == 'actors'} ? 'active'" onclick="closeMobileMenu()">演员介绍</a>
                    </li>
                    <li class="nav-item">
                        <a th:href="@{/meaning}" class="nav-link" th:classappend="${activePage == 'meaning'} ? 'active'" onclick="closeMobileMenu()">电影内涵</a>
                    </li>
                    <li class="nav-item">
                        <a th:href="${user != null ? '/review/' + user.username : '/review/qinguijin'}" class="nav-link" th:classappend="${activePage == 'review'} ? 'active'" onclick="closeMobileMenu()">观影感悟</a>
                    </li>
                    <li class="nav-item dropdown" th:if="${user != null}">
                        <a href="#" class="nav-link" th:classappend="${activePage == 'profile' || activePage == 'review-edit' || activePage == 'password-change'} ? 'active'">个人中心 ▼</a>
                        <ul class="dropdown-menu">
                            <li><a th:href="@{/review/edit}" onclick="closeMobileMenu()">编辑观后感</a></li>
                            <li><a th:href="@{/password/change}" onclick="closeMobileMenu()">修改密码</a></li>
                            <li><a th:href="@{/profile}" onclick="closeMobileMenu()">我的资料</a></li>
                            <li><a th:href="@{/logout}" onclick="closeMobileMenu()">退出</a></li>
                        </ul>
                    </li>
                    <li class="nav-item" th:if="${user == null}">
                        <a th:href="@{/login}" class="nav-link" onclick="closeMobileMenu()">登录</a>
                    </li>
                </ul>
            </div>
        </nav>
        <div class="mobile-overlay" id="mobileOverlay" onclick="closeMobileMenu()"></div>
        <!-- 菜单在遮罩层之后，确保在DOM中后渲染 -->
    </header>
    
    <script th:inline="javascript">
        function toggleMobileMenu() {
            const navMenu = document.getElementById('navMenu');
            const hamburger = document.querySelector('.hamburger');
            const mobileOverlay = document.getElementById('mobileOverlay');
            const body = document.body;
            
            const isActive = navMenu.classList.contains('active');
            
            if (isActive) {
                // 关闭菜单
                navMenu.classList.remove('active');
                hamburger.classList.remove('active');
                mobileOverlay.classList.remove('active');
                body.classList.remove('menu-open');
            } else {
                // 打开菜单
                navMenu.classList.add('active');
                hamburger.classList.add('active');
                mobileOverlay.classList.add('active');
                body.classList.add('menu-open');
            }
        }
        
        function closeMobileMenu() {
            const navMenu = document.getElementById('navMenu');
            const hamburger = document.querySelector('.hamburger');
            const mobileOverlay = document.getElementById('mobileOverlay');
            const body = document.body;
            
            navMenu.classList.remove('active');
            hamburger.classList.remove('active');
            mobileOverlay.classList.remove('active');
            body.classList.remove('menu-open');
        }
        
        // 监听窗口大小变化，如果从移动端切换到PC端，自动关闭菜单
        window.addEventListener('resize', function() {
            if (window.innerWidth > 768) {
                closeMobileMenu();
            }
        });
    </script>
</body>
</html>

